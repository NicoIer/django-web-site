{% extends 'extends/user_base.html' %}
{% load static %}
{% block title %}
	Login
{% endblock %}


{% block css %}

{% endblock css %}
{% block style %}
	<link rel="stylesheet" href="{% static 'web/css/account.css' %}">
{% endblock style %}

{% block content %}
	<div class="account container">
		<div class="title">
			用户登录
		</div>
		<form novalidate id="login_form" method="post" class="form-signin" onsubmit="return false">
			{% csrf_token %}
			{% for field in form %}
				<label for="{{ field.id_for_label }}">{{ field.label }}</label>
				{{ field }}
			{% endfor %}
			<br>
			<button class="btn btn-lg btn-primary btn-block" type="submit" onclick="LoginBtnClick()">Login</button>
		</form>
	</div>
{% endblock content %}

{% block js %}
	<script type="text/javascript" src="{% static 'web/js/util.js' %}"></script>
	<script>
        function LoginBtnClick() {
            const check_data = form_check('#login_form');
            const login_data = check_data['data'];
            $.ajax({
                url: '{% url 'login' %}',
                type: 'post',
                data: login_data,
                success: function (res) {
                    if (res.status) {
                        console.log('成功')
                        location.href = res.href
                    } else {
                        console.log('失败')
                        $.each(res.error, function (key, value) {
                            const id_ = $('#id_' + key);
                            setTimeout(function () {
                                id_.popover('hide')
                            }, 3000);
                            id_.attr('data-content', value)
                            id_.popover('show')
                        })
                    }
                }
            })
        }
	</script>
{% endblock js %}